<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSLSA | Official Licensed Surveyors Portal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .gov-navy { background-color: #002147; }
        .hero-gradient { background: linear-gradient(135deg, #002147 0%, #003366 100%); }
        .modal { transition: opacity 0.25s ease; }
        
        /* Print Configuration */
        @media print {
            body * { visibility: hidden; }
            #printSection, #printSection * { visibility: visible; }
            #printSection { 
                position: absolute; left: 0; top: 0; width: 100%; 
                display: block !important; border: none !important; 
            }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <nav class="bg-white border-b-4 border-orange-500 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 h-20 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="bg-blue-900 text-white p-2 rounded-lg">
                    <i class="fas fa-monument text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-black text-blue-900 leading-none">TSLSA</h1>
                    <p class="text-[10px] uppercase tracking-widest text-slate-400 font-bold">Telangana State Licensed Surveyors Association</p>
                </div>
            </div>
            <div class="hidden md:flex items-center space-x-6 text-xs font-bold uppercase tracking-wider text-slate-600">
                <a href="#home" class="hover:text-blue-900">Home</a>
                <a href="#directory" class="hover:text-blue-900">Directory</a>
                <a href="https://docs.google.com/spreadsheets/d/1GTQ3JvpM3f6VeEvAjFzQtXAFSwXSU-M8ZAuBRrUuic8/edit" target="_blank" class="bg-blue-900 text-white px-4 py-2 rounded-md hover:bg-blue-800 transition">Staff Login</a>
            </div>
        </div>
    </nav>

    <header id="home" class="hero-gradient text-white py-16 relative">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <span class="bg-orange-500 text-white px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest mb-4 inline-block">Official Verification Portal</span>
            <h2 class="text-4xl md:text-5xl font-black mb-4 tracking-tight">MEMBER REGISTRY</h2>
            <p class="text-blue-100 text-lg max-w-2xl mx-auto font-light">Search and verify the credentials of licensed land surveyors registered with the TSLSA across all districts.</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 -mt-8 pb-20">
        
        <div id="verifyBanner" class="hidden bg-emerald-600 text-white p-5 rounded-xl mb-8 flex items-center gap-4 shadow-xl animate-bounce">
            <i class="fas fa-check-circle text-3xl"></i>
            <div>
                <h4 class="font-bold">Identity Verified</h4>
                <p class="text-xs opacity-90">This surveyor is an active registered member of the TSLSA database.</p>
            </div>
            <button onclick="window.location.href=window.location.pathname" class="ml-auto bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-xs font-bold uppercase">Clear View</button>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-xl border border-slate-100 grid grid-cols-1 md:grid-cols-4 gap-4 mb-10">
            <div class="relative md:col-span-1">
                <i class="fas fa-search absolute left-4 top-4 text-slate-400"></i>
                <input type="text" id="nameInput" onkeyup="searchSurveyors()" placeholder="Name or Mobile..." class="w-full pl-12 p-4 border rounded-xl outline-none focus:ring-2 focus:ring-blue-900 transition bg-slate-50">
            </div>
            <select id="districtSelect" onchange="searchSurveyors()" class="p-4 border rounded-xl bg-slate-50 outline-none focus:ring-2 focus:ring-blue-900 font-bold text-slate-600">
                <option value="">All Districts</option>
                <option value="Nizamabad">Nizamabad</option>
                <option value="Hyderabad">Hyderabad</option>
                <option value="Warangal">Warangal</option>
                <option value="Rangareddy">Rangareddy</option>
                <option value="Medak">Medak</option>
            </select>
            <input type="text" id="mandalInput" onkeyup="searchSurveyors()" placeholder="Mandal..." class="p-4 border rounded-xl bg-slate-50 outline-none focus:ring-2 focus:ring-blue-900">
            <button onclick="exportToCSV()" class="bg-emerald-600 hover:bg-emerald-700 text-white font-black rounded-xl py-4 transition flex items-center justify-center gap-2">
                <i class="fas fa-file-excel"></i> EXPORT RECORDS
            </button>
        </div>

        <div id="directory" class="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 border-b">
                        <tr>
                            <th class="px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest">Surveyor Details</th>
                            <th class="px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest hidden md:table-cell">Jurisdiction</th>
                            <th class="px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest text-center">Status</th>
                            <th class="px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="memberTable" class="divide-y divide-slate-100">
                        </tbody>
                </table>
            </div>
        </div>
    </main>

    <div id="printSection" class="hidden p-12 bg-white border-[15px] border-double border-blue-900">
        <div class="text-center border-b-4 border-orange-500 pb-6 mb-8">
            <h1 class="text-3xl font-black text-blue-900 uppercase">Verification Certificate</h1>
            <p class="text-xs font-bold text-slate-500 uppercase tracking-widest mt-1">TS Licensed Surveyors Association</p>
        </div>
        <div class="grid grid-cols-3 gap-8">
            <div class="col-span-2 space-y-6">
                <div>
                    <label class="text-[10px] font-black text-slate-300 uppercase">Licensed Member</label>
                    <h2 id="printName" class="text-4xl font-black text-slate-900 uppercase"></h2>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] font-black text-slate-300 uppercase">Status</label>
                        <p class="text-xl font-bold text-emerald-600 uppercase">‚óè Active</p>
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-300 uppercase">Verified On</label>
                        <p id="printDate" class="text-xl font-bold text-slate-700"></p>
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-300 uppercase">Mandal & District</label>
                    <p class="text-xl font-bold text-slate-800 uppercase"><span id="printMandal"></span>, <span id="printDist"></span></p>
                </div>
            </div>
            <div class="flex flex-col items-center justify-center border-l-2 pl-8">
                <div id="qrcode"></div>
                <p class="text-[8px] font-black text-center text-blue-900 uppercase mt-4">Scan to Verify Digital Record</p>
            </div>
        </div>
    </div>

    <footer class="gov-navy text-white py-12">
        <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-10 opacity-80 border-b border-white/10 pb-10">
            <div>
                <h3 class="font-black text-orange-500 text-xs uppercase tracking-widest mb-4">About TSLSA</h3>
                <p class="text-xs leading-relaxed">The Telangana State Licensed Surveyors Association is the apex body ensuring standards and ethics in land surveying across the state.</p>
            </div>
            <div>
                <h3 class="font-black text-orange-500 text-xs uppercase tracking-widest mb-4">Quick Help</h3>
                <ul class="text-xs space-y-2">
                    <li><a href="javascript:void(0)" onclick="alert('For support, please email: support@tslsa.org')" class="hover:text-orange-400">Contact Support</a></li>
                    <li><a href="javascript:void(0)" onclick="alert('This portal displays data for verification. Commercial use of this data is prohibited.')" class="hover:text-orange-400">Privacy Policy</a></li>
                    <li><a href="javascript:void(0)" onclick="alert('Users are advised to verify certificates via the QR code provided on the document.')" class="hover:text-orange-400">Terms of Use</a></li>
                </ul>
            </div>
            <div class="text-right">
                <h3 class="font-black text-orange-500 text-xs uppercase tracking-widest mb-4">Administration</h3>
                <a href="https://docs.google.com/spreadsheets/d/1GTQ3JvpM3f6VeEvAjFzQtXAFSwXSU-M8ZAuBRrUuic8/edit" class="text-xs underline hover:text-orange-400">Database Login</a>
            </div>
        </div>
        <p class="text-center text-[10px] font-bold text-white/40 mt-8 tracking-[0.2em] uppercase">&copy; 2025 TSLSA | Government of Telangana Licensed Professionals Registry</p>
    </footer>

    <script>
        let surveyors = [];
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/1GTQ3JvpM3f6VeEvAjFzQtXAFSwXSU-M8ZAuBRrUuic8/export?format=csv';

        async function loadData() {
            const tableBody = document.getElementById('memberTable');
            tableBody.innerHTML = `<tr><td colspan="4" class="p-20 text-center text-slate-400 font-bold animate-pulse uppercase tracking-widest">Connecting to Registry...</td></tr>`;

            try {
                const response = await fetch(SHEET_CSV_URL);
                const csvData = await response.text();
                const rows = csvData.split('\n').slice(1);
                
                surveyors = rows.map((row, index) => {
                    const cols = row.split(',');
                    return {
                        id: cols[0]?.trim() || `IDX-${index}`,
                        name: cols[1]?.trim() || 'N/A',
                        dist: cols[2]?.trim() || 'N/A',
                        mandal: cols[3]?.trim() || 'N/A',
                        status: cols[4]?.trim() || 'Active',
                        phone: cols[5]?.trim() || 'N/A'
                    };
                }).filter(s => s.name !== 'N/A');

                const urlParams = new URLSearchParams(window.location.search);
                const verifyId = urlParams.get('id');
                if (verifyId) {
                    document.getElementById('verifyBanner').classList.remove('hidden');
                    renderTable(surveyors.filter(s => s.id === verifyId));
                } else {
                    renderTable(surveyors);
                }
            } catch (err) {
                tableBody.innerHTML = `<tr><td colspan="4" class="p-20 text-center text-red-500 font-bold">Failed to load database.</td></tr>`;
            }
        }

        function renderTable(data) {
            const tableBody = document.getElementById('memberTable');
            if (data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="4" class="p-20 text-center text-slate-400">No records found.</td></tr>`;
                return;
            }

            tableBody.innerHTML = data.map(s => `
                <tr class="hover:bg-blue-50/50 transition duration-150">
                    <td class="px-6 py-5">
                        <div class="font-black text-slate-800 text-base uppercase tracking-tight">${s.name}</div>
                        <div class="text-[10px] text-blue-900 font-bold flex items-center gap-1 mt-1 opacity-70">
                            <i class="fas fa-phone-alt"></i> ${s.phone}
                        </div>
                    </td>
                    <td class="px-6 py-5 hidden md:table-cell">
                        <div class="text-sm font-bold text-slate-700 uppercase">${s.mandal}</div>
                        <div class="text-[10px] text-slate-400 font-black uppercase tracking-widest">${s.dist}</div>
                    </td>
                    <td class="px-6 py-5 text-center">
                        <span class="px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest ${s.status.toLowerCase() === 'active' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}">
                            ${s.status}
                        </span>
                    </td>
                    <td class="px-6 py-5 text-right">
                        <button onclick="printOfficialID('${s.id}')" class="bg-slate-100 hover:bg-blue-900 hover:text-white p-3 rounded-lg transition shadow-sm">
                            <i class="fas fa-print"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function searchSurveyors() {
            const q = document.getElementById('nameInput').value.toLowerCase();
            const d = document.getElementById('districtSelect').value.toLowerCase();
            const m = document.getElementById('mandalInput').value.toLowerCase();

            const filtered = surveyors.filter(s => 
                (s.name.toLowerCase().includes(q) || s.phone.includes(q)) &&
                (d === "" || s.dist.toLowerCase() === d) &&
                (s.mandal.toLowerCase().includes(m))
            );
            renderTable(filtered);
        }

        function printOfficialID(uid) {
            const s = surveyors.find(item => item.id === uid);
            if(!s) return;

            document.getElementById('printName').innerText = s.name;
            document.getElementById('printMandal').innerText = s.mandal;
            document.getElementById('printDist').innerText = s.dist;
            document.getElementById('printDate').innerText = new Date().toLocaleDateString('en-IN', { day: '2-digit', month: 'long', year: 'numeric'});
            
            const qrContainer = document.getElementById("qrcode");
            qrContainer.innerHTML = "";
            new QRCode(qrContainer, {
                text: window.location.origin + window.location.pathname + "?id=" + s.id,
                width: 120, height: 120, colorDark: "#002147"
            });

            setTimeout(() => { window.print(); }, 800);
        }

        function exportToCSV() {
            let csv = "Name,District,Mandal,Status,Phone\n" + surveyors.map(s => `"${s.name}","${s.dist}","${s.mandal}","${s.status}","${s.phone}"`).join("\n");
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `TSLSA_Registry_2025.csv`;
            a.click();
        }

        loadData();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSLSA | Telangana Licensed Surveyors Official Portal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Official Telangana Colors */
        .ts-green { background-color: #056a3e; } /* State Green */
        .ts-gold { background-color: #ffcc00; } /* State Gold accent */
        .gov-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }

        @media print {
            body * { visibility: hidden; }
            #printSection, #printSection * { visibility: visible; }
            #printSection { position: absolute; left: 0; top: 0; width: 100%; display: block !important; }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900">

    <div class="bg-white border-b border-gray-200 py-2 px-4 flex justify-between items-center text-[10px] font-semibold text-gray-600 uppercase tracking-widest">
        <span>Government of Telangana</span>
        <span>Revenue Department (Survey & Land Records)</span>
    </div>

    <nav class="ts-green text-white gov-shadow sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-20 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="bg-white p-1 rounded-full w-14 h-14 flex items-center justify-center overflow-hidden">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Government_of_Telangana_Logo.png/600px-Government_of_Telangana_Logo.png" alt="TS Emblem">
                </div>
                <div>
                    <h1 class="text-xl font-bold leading-tight">TSLSA</h1>
                    <p class="text-[10px] uppercase opacity-80 tracking-tighter">Telangana State Licensed Surveyors Association</p>
                </div>
            </div>
            <div class="hidden md:flex gap-6 text-xs font-bold uppercase">
                <a href="#" class="hover:text-yellow-400">Home</a>
                <a href="#" class="hover:text-yellow-400">Search Records</a>
                <a href="#" class="bg-yellow-500 text-green-900 px-3 py-2 rounded">Staff Login</a>
            </div>
        </div>
    </nav>

    <header class="bg-white border-b py-10">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="text-center md:text-left">
                <h2 class="text-2xl font-extrabold text-green-900">Member Verification Service</h2>
                <p class="text-gray-500 text-sm">Real-time authentication of licensed surveyors across Telangana.</p>
            </div>
            <div class="flex gap-2">
                <div class="bg-green-50 px-4 py-2 rounded-lg border border-green-200">
                    <p class="text-[10px] font-bold text-green-700 uppercase">Last Updated</p>
                    <p class="text-sm font-bold text-green-900" id="lastUpdate">Checking...</p>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        
        <div class="bg-white p-6 rounded-xl gov-shadow border border-gray-200 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="md:col-span-2 relative">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="searchInput" onkeyup="filterData()" placeholder="Enter Surveyor Name, License No, or Mobile..." 
                           class="w-full pl-12 pr-4 py-4 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:border-transparent outline-none transition">
                </div>
                <select id="distFilter" onchange="filterData()" class="p-4 bg-gray-50 border border-gray-300 rounded-lg outline-none cursor-pointer">
                    <option value="">Select District</option>
                    <option value="Nizamabad">Nizamabad</option>
                    <option value="Hyderabad">Hyderabad</option>
                    <option value="Warangal">Warangal</option>
                </select>
                <button onclick="exportCSV()" class="bg-green-700 hover:bg-green-800 text-white font-bold rounded-lg transition py-4 flex items-center justify-center gap-2">
                    <i class="fas fa-file-export"></i> Download Report
                </button>
            </div>
        </div>

        <div class="bg-white rounded-xl gov-shadow border border-gray-200 overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-gray-50 border-b border-gray-200 text-gray-500 text-[11px] font-bold uppercase tracking-wider">
                    <tr>
                        <th class="px-6 py-4">Credential ID</th>
                        <th class="px-6 py-4">Member Name</th>
                        <th class="px-6 py-4 hidden md:table-cell">Area of Operation</th>
                        <th class="px-6 py-4 text-center">License Status</th>
                        <th class="px-6 py-4 text-right">Certificate</th>
                    </tr>
                </thead>
                <tbody id="dataTable" class="divide-y divide-gray-100 text-sm">
                    <tr><td colspan="5" class="p-20 text-center text-gray-400 italic">Connecting to Bhu Bharati Data Sync...</td></tr>
                </tbody>
            </table>
        </div>
    </main>

    <div id="printSection" class="hidden p-10 bg-white border-[16px] border-double border-green-800 rounded-sm">
        <div class="flex items-center justify-between border-b-2 border-green-800 pb-6 mb-8">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Government_of_Telangana_Logo.png/600px-Government_of_Telangana_Logo.png" class="w-20">
            <div class="text-center">
                <h1 class="text-2xl font-black text-green-900 tracking-tight">TELANGANA STATE LICENSED SURVEYORS ASSOCIATION</h1>
                <p class="text-[10px] font-bold text-gray-600 uppercase tracking-[0.2em]">Authorized Verification Certificate</p>
            </div>
            <div class="w-20"></div> </div>
        
        <div class="grid grid-cols-3 gap-8">
            <div class="col-span-2">
                <p class="text-xs font-bold text-gray-400 uppercase mb-1">Full Registered Name</p>
                <h2 id="pName" class="text-4xl font-black text-gray-900 uppercase mb-6"></h2>
                
                <div class="grid grid-cols-2 gap-6 border-t border-gray-100 pt-6">
                    <div>
                        <p class="text-[10px] font-bold text-gray-400 uppercase">License Number</p>
                        <p id="pID" class="text-xl font-mono font-bold text-green-800"></p>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-gray-400 uppercase">Status</p>
                        <p class="text-lg font-bold text-green-600 uppercase">‚óè Active Member</p>
                    </div>
                </div>
            </div>
            <div class="flex flex-col items-center justify-center bg-gray-50 border border-gray-200 rounded-xl p-4">
                <div id="qrcode"></div>
                <p class="text-[9px] font-black text-green-900 mt-4 text-center uppercase">Scan for Live Digital Authenticity</p>
            </div>
        </div>

        <div class="mt-16 pt-8 border-t border-gray-100 flex justify-between items-end">
            <div>
                <p class="text-[10px] text-gray-400 uppercase mb-1">District/Mandal</p>
                <p class="font-bold text-gray-800 uppercase text-sm"><span id="pMandal"></span>, <span id="pDist"></span></p>
            </div>
            <div class="text-center">
                <div class="w-40 border-b-2 border-gray-300 mb-2"></div>
                <p class="text-[10px] font-black text-gray-500 uppercase">Office of the TSLSA</p>
            </div>
            <p class="text-[9px] text-gray-400 italic">Generated on: <span id="pDate" class="font-bold"></span></p>
        </div>
    </div>

    <script>
        let rawData = [];
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/1GTQ3JvpM3f6VeEvAjFzQtXAFSwXSU-M8ZAuBRrUuic8/export?format=csv';

        async function init() {
            try {
                const res = await fetch(CSV_URL);
                const text = await res.text();
                const rows = text.split('\n').slice(1);
                rawData = rows.map(row => {
                    const c = row.split(',');
                    return { id: c[0]?.trim(), name: c[1]?.trim(), dist: c[2]?.trim(), mandal: c[3]?.trim(), status: c[4]?.trim(), phone: c[5]?.trim(), expiry: c[6]?.trim() };
                }).filter(r => r.id);
                
                document.getElementById('lastUpdate').innerText = new Date().toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric'});
                render(rawData);
            } catch(e) {
                document.getElementById('dataTable').innerHTML = `<tr><td colspan="5" class="p-12 text-center text-red-500 font-bold">Failed to synchronize with central server. Check internet.</td></tr>`;
            }
        }

        function render(data) {
            const table = document.getElementById('dataTable');
            if(data.length === 0) { table.innerHTML = '<tr><td colspan="5" class="p-20 text-center text-gray-400">No matching official records found.</td></tr>'; return; }

            table.innerHTML = data.map(s => `
                <tr class="hover:bg-green-50/40 transition duration-200">
                    <td class="px-6 py-5 font-mono font-bold text-green-800">${s.id}</td>
                    <td class="px-6 py-5 font-bold text-gray-800 uppercase">${s.name}</td>
                    <td class="px-6 py-5 hidden md:table-cell">
                        <span class="text-gray-400 text-[10px] block font-bold uppercase">Jurisdiction</span>
                        <span class="text-gray-700 font-semibold">${s.mandal}, ${s.dist}</span>
                    </td>
                    <td class="px-6 py-5 text-center">
                        <span class="px-4 py-1.5 rounded-full text-[10px] font-bold uppercase bg-green-100 text-green-800 border border-green-200">
                            ${s.status}
                        </span>
                    </td>
                    <td class="px-6 py-5 text-right">
                        <button onclick="doPrint('${s.id}')" class="bg-gray-100 hover:bg-green-900 hover:text-white p-3 rounded-lg transition shadow-sm">
                            <i class="fas fa-certificate"></i>
                        </button>
                    </td>
                </tr>`).join('');
        }

        function filterData() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const d = document.getElementById('distFilter').value.toLowerCase();
            const filtered = rawData.filter(s => 
                (s.name.toLowerCase().includes(q) || s.id.toLowerCase().includes(q) || (s.phone && s.phone.includes(q))) &&
                (d === "" || s.dist.toLowerCase() === d)
            );
            render(filtered);
        }

        function doPrint(id) {
            const s = rawData.find(x => x.id === id);
            document.getElementById('pName').innerText = s.name;
            document.getElementById('pID').innerText = s.id;
            document.getElementById('pMandal').innerText = s.mandal;
            document.getElementById('pDist').innerText = s.dist;
            document.getElementById('pDate').innerText = new Date().toLocaleDateString('en-IN');
            
            const qr = document.getElementById("qrcode");
            qr.innerHTML = "";
            new QRCode(qr, { text: window.location.href + "?id=" + s.id, width: 140, height: 140, colorDark: "#056a3e" });
            
            setTimeout(() => { window.print(); }, 600);
        }

        function exportCSV() {
            let c = "License,Name,District,Mandal,Status,Phone,Expiry\n" + rawData.map(s => `"${s.id}","${s.name}","${s.dist}","${s.mandal}","${s.status}","${s.phone}","${s.expiry}"`).join("\n");
            const b = new Blob([c], { type: 'text/csv' });
            const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'TSLSA_Surveyors_List.csv'; a.click();
        }

        init();
    </script>
</body>
</html>
